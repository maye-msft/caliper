<?xml version="1.0" encoding="UTF-8"?>

<entity-mappings version="2.1"
	xmlns="http://www.eclipse.org/eclipselink/xsds/persistence/orm"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

	<package>org.point85.uom</package>

	<!-- UnitOfMeasure table -->
	<entity class="UnitOfMeasure" access="FIELD">
	<table name="UOM" />
		<attributes>
			<!-- primary key -->
			<id name="primaryKey" attribute-type="Integer">
				<column name="UOM_KEY" />
				<generated-value strategy="IDENTITY"/>
			</id>
			
			<!-- version -->
			<version name="version" >
				<column name="VERSION"/> 
			</version>
			
			<!-- name -->
			<basic name="name" attribute-type="String">
				<column name="NAME" />
			</basic>
		
			<!-- symbol -->
			<basic name="symbol" attribute-type="String">
				<column name="SYMBOL" />
			</basic>
			
			<!-- description -->
			<basic name="description" attribute-type="String">
				<column name="DESCRIPTION" />
			</basic>

			<!-- category -->
			<basic name="category" attribute-type="String">
				<column name="CATEGORY" />
			</basic>	
			
			<!-- unit type -->
			<basic name="unitType">
				<enumerated>STRING</enumerated>
				<column name="UNIT_TYPE" />
			</basic>
			
			<!-- unit enumeration -->
			<basic name="unit">
				<enumerated>STRING</enumerated>
				<column name="UNIT" />
			</basic>
			
			<!-- conversion -->
			<basic name="scalingFactor">
				<column name="CONV_FACTOR" precision="16" scale="9" />
			</basic>
		
			<basic name="offset">
				<column name="CONV_OFFSET" precision="16" scale="9" />
			</basic>
						
			<one-to-one name="abscissaUnit" fetch="EAGER" target-entity="UnitOfMeasure">
				<join-column name="CONV_UOM_KEY" />
				<cascade>
					<cascade-persist />
				</cascade>	
			</one-to-one>	
			
			<!-- bridge conversion -->
			<basic name="bridgeScalingFactor">
				<column name="BRIDGE_FACTOR" precision="16" scale="9" />
			</basic>
		
			<basic name="bridgeOffset">
				<column name="BRIDGE_OFFSET" precision="16" scale="9" />
			</basic>
			
			<one-to-one name="bridgeAbscissaUnit" fetch="EAGER" target-entity="UnitOfMeasure">
				<join-column name="BRIDGE_UOM_KEY" />
				<cascade>
					<cascade-persist />
				</cascade>	
			</one-to-one>	
				
			<!-- UOM1 -->
			<one-to-one name="uom1" fetch="EAGER" target-entity="UnitOfMeasure"> -->
				<join-column name="UOM1_KEY" />
				<cascade>
					<cascade-persist />
				</cascade>
			</one-to-one>
			
			<!-- exponent1 -->
			<basic name="exponent1" attribute-type="Integer">
				<column name="EXP1" />
			</basic>
			
			<!-- UOM2 -->
			<one-to-one name="uom2" fetch="EAGER" target-entity="UnitOfMeasure">
				<join-column name="UOM2_KEY" />
				<cascade>
					<cascade-persist />
				</cascade>
			</one-to-one>
			
			<!-- exponent2 -->
			<basic name="exponent2" attribute-type="Integer">
				<column name="EXP2" />
			</basic>
			
			<!-- transient attributes -->
			<transient name="conversionRegistry"/>
			<transient name="baseSymbol"/>
					
		</attributes>
	</entity>
	
	<named-query name="UOM.Categories">
		<query>SELECT DISTINCT uom.category FROM UnitOfMeasure uom WHERE uom.category IS NOT NULL</query>
	</named-query>
	
	<named-query name="UOM.Symbols">
		<query>SELECT uom.symbol, uom.name FROM UnitOfMeasure uom WHERE uom.unit IS NULL AND uom.unitType = :type</query>
	</named-query>	
	
	<named-query name="UOM.SymbolsInCategory">
		<query>SELECT uom.symbol, uom.name FROM UnitOfMeasure uom WHERE uom.category = :category</query>
	</named-query>
	
	<named-query name="UOM.BySymbol">
		<query>SELECT uom FROM UnitOfMeasure uom WHERE uom.symbol = :symbol</query>
	</named-query>
	
	<named-query name="UOM.ByUnit">
		<query>SELECT uom FROM UnitOfMeasure uom WHERE uom.unit = :unit</query>
	</named-query>
	
	<named-query name="UOM.ByKey">
		<query>SELECT uom FROM UnitOfMeasure uom WHERE uom.primaryKey = :key</query>
	</named-query>
	
	<named-native-query name="UOM.CrossRef">
		<query>select UOM_KEY from UOM where UOM1_KEY = ?1 OR UOM2_KEY = ?1 OR BRIDGE_UOM_KEY = ?1 OR CONV_UOM_KEY = ?1 AND CONV_UOM_KEY != UOM_KEY</query>
	</named-native-query>
	
</entity-mappings>